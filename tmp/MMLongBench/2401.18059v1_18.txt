Published as a conference paper at ICLR 2024
Algorithm 2 Collapsed Tree Algorithm
function COLLAPSEDTREE(tree, query, k, max tokens)
tree ←flatten(tree)
▷Flatten tree into 1D
top nodes ←[]
for node in tree do
top nodes.append((node, dot product(query, node))
end for
top nodes ←sorted(top nodes)
result ←[]
total tokens ←0
for node in top nodes do
if total tokens + node.token size < max tokens then
result.append(node)
end if
total tokens ←total tokens + node.token size
end for
return result
end function
Question: What is the central theme of the story?
RAPTOR
Fairy Godmother helps Cinderella attend a ball by transforming her rags. . . Cinderella
impresses the Prince at the ball. . . she loses track of time and has to run home alone in
the darkness. The Prince is unable to find Cinderella and goes in search of her . . . She
forgave her sisters, and treated them always very kindly, and the Prince had great cause
to be glad that he had found the glass slipper.
DPR
Two mice were turned into footmen; four grasshoppers into white horses. Next, the
Fairy touched Cinderella’s rags, and they became rich satin robes, trimmed with point
lace. ... Alas! the clock had struck Eleven. She found no coach, only a pumpkin, and
the rat and mice ran quickly away when they saw her; while all her fine dress turned to
rags, and she had to run home alone. . . They told her a beautiful Princess had been at
the ball, with whom the Prince was delighted. They did not know it was Cinderella.
Question: How does Cinderella find a happy ending?
RAPTOR
The story of Cinderella involves her godmother, a fairy, who transforms a pumpkin
into a grand coach with her wand and allows Cinderella to attend the ball. However,
Cinderella must return home before the clock strikes eleven or her dress will turn back
into rags... Cinderella impresses the Prince at the ball but leaves before he can find
out who she is... The Prince searched for the owner of a lost glass slipper and found it
belonged to Cinderella. She forgave her sisters and the Prince was glad to have found
her.
DPR
the clock had struck Eleven. . . The Prince was very much surprised when he missed
Cinderella again, and leaving the ball, went in search of her. . .
Fairy touched Cin-
derella’s rags, and they became rich satin robes, trimmed with point lace... Her old
shoes became a charming pair of glass slippers, which shone like diamonds. “Now go
to the ball, my love,” she said, “and enjoy yourself. But remember, you must leave the
room before the clock strikes eleven. If you do not your dress will return to its original
rags.”
Table 12: Relevant excerpts from text retrieved by RAPTOR and DPR for the questions on the
fairytale Cinderella.
question at hand. Further, the information that would be retrieved by DPR is more often than not
included in the context retrieved by RAPTOR, either directly as a leaf node or indirectly as part of a
summary from a higher layer.
”The first question we examine is “How does Cinderella find a happy ending?”, a multi-hop question
best answered by synthesizing information from various text segments. To control for the language
model’s potential familiarity with the Cinderella story, we instructed it to rely solely on the retrieved
information for its answers. Table 13 shows the text retrieved by both RAPTOR and DPR for this
question. RAPTOR’s context succinctly describes Cinderella’s journey to happiness, while DPR’s
leaf nodes primarily focus on her initial transformation. The difference in retrieved information
19
